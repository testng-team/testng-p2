buildscript {
	repositories {
		jcenter()
	}
	dependencies {
		classpath 'org.standardout:bnd-platform:1.4.0'
	}
}

def buildTime() {
       def df = new java.text.SimpleDateFormat("yyyyMMddHHmmss")
       df.setTimeZone(TimeZone.getTimeZone("UTC"))
       return df.format(new Date())
}

apply plugin: 'org.standardout.bnd-platform'

repositories {
	mavenCentral()
	jcenter()
    maven {
        url 'https://oss.sonatype.org/content/repositories/snapshots'
    }
}

// project version is also platform feature version default,
// here uses TestNG version as project version.
version = '6.9.13-SNAPSHOT'

def versionWithQualifier = version.replaceAll('-SNAPSHOT', "." + buildTime())

defaultTasks 'clean', 'updateSiteZip'

platform {
	feature(id: 'org.testng.p2.feature', name: 'TestNG Feature') {
		plugin "org.testng:testng:${version}", {
		    bnd {
            	optionalImport 'com.google.common.*'
        	}
			exclude module: 'ant'
		}
	}

	featureId 'org.testng.p2.feature'
	featureName 'TestNG Feature'
	featureVersion versionWithQualifier

	categoryName 'TestNG Libraries'
	categoryId 'org.testng.p2.libraries'
	
	useBndHashQualifiers false
    defaultQualifier ''
    
    bnd(group: 'org.testng', name: 'testng', version: "${version}") {
		version = versionWithQualifier
	}
}

task wrapper(type: Wrapper) {
	gradleVersion = '3.1'
}
